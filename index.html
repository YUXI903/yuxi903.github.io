<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的烹饪日记</title>
    <!-- 引入 Tailwind CSS 以便快速构建美观的界面 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts 的 Inter 字体，让页面更好看 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 自定义一些基础样式 */
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* 优化移动端触摸体验 */
        }
        /* 当输入框聚焦时，给一点平滑的过渡效果 */
        input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
            border-color: rgb(59 130 246);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto max-w-lg p-4">
        
        <!-- 页面标题 -->
        <header class="text-center my-6">
            <h1 class="text-3xl font-bold text-gray-700">我的烹饪日记</h1>
            <p class="text-gray-500 mt-1">记录每一次的美味创作</p>
        </header>

        <!-- 添加新菜品的表单 -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <form id="add-dish-form">
                <h2 class="text-xl font-semibold mb-4">添加一道新菜</h2>
                <div class="space-y-4">
                    <!-- 菜品名称输入框 -->
                    <div>
                        <label for="dish-name" class="block text-sm font-medium text-gray-600">菜品名称</label>
                        <input type="text" id="dish-name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg transition" placeholder="例如：番茄炒蛋">
                    </div>
                    <!-- 烹饪日期选择器 -->
                    <div>
                        <label for="dish-date" class="block text-sm font-medium text-gray-600">烹饪日期</label>
                        <input type="date" id="dish-date" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg transition">
                    </div>
                    <!-- 图片链接输入框 -->
                    <div>
                        <label for="dish-image" class="block text-sm font-medium text-gray-600">图片链接</label>
                        <input type="url" id="dish-image" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg transition" placeholder="请粘贴图片的 URL 地址">
                        <p class="text-xs text-gray-400 mt-1">小提示：可以先把图片上传到图床网站，再粘贴链接。</p>
                    </div>
                </div>
                <!-- 提交按钮 -->
                <button type="submit" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform active:scale-95">
                    添加菜品
                </button>
            </form>
        </div>

        <!-- 展示所有菜品的列表 -->
        <main>
            <h2 class="text-xl font-semibold mb-4 text-center text-gray-600">我做过的菜</h2>
            <div id="dish-list" class="grid grid-cols-1 gap-6">
                <!-- JavaScript 将会在这里动态添加菜品卡片 -->
                <div id="empty-state" class="text-center py-10 px-4 bg-white rounded-xl shadow-md">
                    <p class="text-gray-500">还没有记录任何菜品哦，快去添加吧！</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('add-dish-form');
            const dishList = document.getElementById('dish-list');
            const emptyState = document.getElementById('empty-state');

            // 预设今天的日期到日期输入框
            const dateInput = document.getElementById('dish-date');
            dateInput.valueAsDate = new Date();

            // 从 localStorage 加载数据
            let dishes = JSON.parse(localStorage.getItem('myDishes')) || [];

            // 渲染所有菜品到页面
            const renderDishes = () => {
                // 先清空现有列表
                dishList.innerHTML = ''; 

                if (dishes.length === 0) {
                    // 如果没有数据，显示空状态提示
                    dishList.appendChild(emptyState);
                    emptyState.style.display = 'block';
                } else {
                    // 如果有数据，则隐藏空状态并渲染列表
                     if (emptyState.parentNode) {
                        emptyState.style.display = 'none';
                    }

                    // 对菜品按日期倒序排序，最新的在最前面
                    const sortedDishes = dishes.sort((a, b) => new Date(b.date) - new Date(a.date));

                    sortedDishes.forEach(dish => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300';
                        
                        // 使用 onerror 来处理图片加载失败的情况
                        card.innerHTML = `
                            <img src="${dish.imageUrl}" alt="${dish.name}" class="w-full h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/475569?text=图片加载失败';">
                            <div class="p-5">
                                <h3 class="text-2xl font-bold">${dish.name}</h3>
                                <p class="text-gray-500 text-sm mt-1">${dish.date}</p>
                            </div>
                            <div class="p-2 bg-gray-50 text-right">
                                <button data-id="${dish.id}" class="delete-btn text-sm text-red-500 hover:text-red-700 font-medium py-1 px-3 rounded">删除</button>
                            </div>
                        `;
                        dishList.appendChild(card);
                    });
                }
            };

            // 保存数据到 localStorage
            const saveDishes = () => {
                localStorage.setItem('myDishes', JSON.stringify(dishes));
            };

            // 处理表单提交事件
            form.addEventListener('submit', (e) => {
                e.preventDefault(); // 阻止表单默认的提交行为

                const name = document.getElementById('dish-name').value.trim();
                const date = document.getElementById('dish-date').value;
                const imageUrl = document.getElementById('dish-image').value.trim();
                
                // 简单验证
                if (!name || !date || !imageUrl) {
                    alert('请填写所有字段！');
                    return;
                }

                const newDish = {
                    id: Date.now(), // 使用时间戳作为唯一ID
                    name,
                    date,
                    imageUrl
                };

                dishes.push(newDish);
                saveDishes();
                renderDishes();

                form.reset(); // 清空表单
                dateInput.valueAsDate = new Date(); // 重置日期为今天
            });

            // 处理删除事件（使用事件委托）
            dishList.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    const idToDelete = Number(e.target.dataset.id);
                    // 弹出一个确认框，防止误删
                    if (confirm('确定要删除这道菜的记录吗？')) {
                        dishes = dishes.filter(dish => dish.id !== idToDelete);
                        saveDishes();
                        renderDishes();
                    }
                }
            });

            // 页面加载时，立即渲染一次
            renderDishes();
        });
    </script>
</body>
</html>

